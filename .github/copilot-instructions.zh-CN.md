> [English](copilot-instructions.md)

# Copilot 使用说明（build-llm-using-cpp）

本仓库是一个**教学优先、从零开始**的 C++ GPT 风格小模型实现。

核心目标：代码易于推理与验证；优先清晰与正确性，而不是技巧。

## 不可妥协

- **改动要小且明确。** 除非直接支持需求，否则避免大规模重构。
- **保持确定性。** 若改动 RNG、采样、数据顺序或初始化，必须保持可复现。
- **不要“魔法依赖”。** 优先标准 C++ 和很小的自包含工具。
- **用代码教学。** 新特性要配套解释（数学 → 代码）。

## 文档与测试契约

当实现一个会改变行为/增加算法的新特性时：

1) 更新文档（高层 + 可手算的 learn-by-hand），并保持一致。
2) 增加/更新测试：修改前失败、修改后通过。
3) 运行测试套件。

权威指引：
- `docs/project_lifecycle_guidelines.md`
- `docs/README.md`

## 双语文档（English + 简体中文）

从现在开始，每个 Markdown 文档都必须提供**两份版本**：
- 英文：`X.md`
- 简体中文：`X.zh-CN.md`

英文文档开头必须包含切换链接：
- `> [简体中文](X.zh-CN.md)`

中文文档开头必须包含切换链接：
- `> [English](X.md)`

新增文档或修改行为时：
- 同一个改动里同时更新两种语言版本。
- 如果中文翻译尚未完成，必须写明“翻译进行中”的提示，并保留英文版本。

## 实现风格

- 优先“shape-first”：在代码/文档中明确张量形状与索引约定。
- 明确内存布局假设（row-major、flat offset 等）。
- 避免添加“复述代码”的注释；更偏好连接公式/形状/不变量的注释。

## 扩展项目

- 若探索替代实现（如 attention 变体、RoPE、KV-cache、GQA），优先并行增加变体，而不是改写基线。
- 若引入新后端（SIMD/GPU），需要清晰边界：
  - 模型数学 / op 语义
  - kernel/后端实现细节

## 不确定时

- 先确认具体论文/变体与预期行为（形状、mask、cache 语义等）。
- 默认先做一个小的、可验证的中间步骤（配文档/测试），避免一次性大改。
